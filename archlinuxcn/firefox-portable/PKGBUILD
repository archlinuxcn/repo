# Maintainer: Kimiblock Moe

pkgname=firefox-portable
pkgver=141.0
pkgrel=3
epoch=1
pkgdesc="Firefox sandboxed by portable"
arch=('any')
url="https://github.com/Kraftland/portable"
license=('GPL-3.0-or-later')
groups=()
options=(!debug !strip)
depends=("portable")
conflicts=("firefox")

optdepends=()

makedepends+=(firefox)

checkdepends=()

source=(
	portable-config
	firefox.sh
	firefox.desktop
)


md5sums=('c4a91aae851117c60742624c1b64a7c9'
         'e9286af04e5d107b38523c92f9c68c76'
         '2f74e3e788705621db286bb25fcabdee')

function prepare() {
	pacman -Ql firefox >file.list
}

function package() {
	while IFS= read -r line; do
		file="$(echo "$line" | awk '{print $2}')"
		if [[ -d ${file} ]]; then
			echo "Omitting Directory"
		else
			install -Dm755 "${file}" "${pkgdir}/${file}"
		fi
	done < file.list
	rm -f "${pkgdir}/usr/share/applications"/*
	rm -f "${pkgdir}/usr/bin"/*
	install -Dm644 portable-config \
		"${pkgdir}/usr/lib/portable/info/org.mozilla.firefox/config"
	install -Dm755 "firefox.sh" \
		"${pkgdir}/usr/bin/firefox-portable"
	install -Dm644 "firefox.desktop" "${pkgdir}/usr/share/applications/org.mozilla.firefox.desktop"
	echo '''[Desktop Entry]
Type=Application
Name=Firefox Web Browser
GenericName=Stub for MPRIS
Icon=firefox
TryExec=portable
Exec=env _portableConfig="org.mozilla.firefox" portable -- %u
Terminal=false
NoDisplay=true''' >"${pkgdir}/usr/share/applications/firefox.desktop"
}
