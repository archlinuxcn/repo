# Maintainer: Kimiblock Moe

pkgname=jellyfin-desktop-portable
pkgver=2.0.0
pkgrel=1
epoch=1
pkgdesc="Jellyfin Desktop. Sandboxed to prevent dGPU wakeups."
arch=('x86_64')
url="https://github.com/Kraftland/portable"
license=('GPL-3.0-or-later')
groups=()
provides=(jellyfin-media-player jellyfin-desktop)
options=(!debug !strip)
#depends=("portable")
replaces+=(jellyfin-media-player-portable)
conflicts=("jellyfin-media-player" jellyfin-desktop)

optdepends=()

makedepends+=(jellyfin-desktop portable)

checkdepends=()

source=(
	portable-config
	jellyfin-media-player.desktop
)


md5sums=('886c7336ab017afd8d2d9a3acbbb18e8'
         'd82778df35e3aca815ba3a75a2d267e1')
function package() {
	depends=("portable" 'mpv' 'mpvqt' 'libcec' 'sdl2' 'p8-platform' 'protobuf' 'qt6-webengine' 'qt6-declarative')

	export pkgdir
	export pkgname
	export srcdir
	portable-packer \
		-v \
		--distro arch \
		--mode copy jellyfin-desktop \
		--hash true \
		--config "${srcdir}/portable-config" \
		--desktop-file "${srcdir}/jellyfin-media-player.desktop"

	echo '''[Desktop Entry]
Type=Application
Name=Jellyfin
GenericName=Stub for MPRIS
Icon=com.github.iwalton3.jellyfin-media-player
TryExec=portable
Exec=env _portableConfig="org.jellyfin.jellyfin-media-player" portable -- %u
Terminal=false
NoDisplay=true''' >"${pkgdir}/usr/share/applications/jellyfin.desktop"
}
