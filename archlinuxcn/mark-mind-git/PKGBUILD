# Maintainer: taotieren <admin@taotieren.com>

_pkgname=mark-mind
_oldpkgname=mind
pkgname=mark-mind-git
pkgver=1.1.9.0.8.g7ee8071
pkgrel=1
pkgdesc="Mark Mind â€” Next generation mind map editor"
arch=('any')
url="https://github.com/MarkMindLtd/Mark-Mind"
license=('MIT')
provides=(${pkgname})
conflicts=("mark-mind")
#replaces=(${pkgname})
depends=('npm')
makedepends=('coreutils' 'npm' 'git')
backup=()
options=('!strip')
source=("${pkgname}"'::git+https://github.com/MarkMindLtd/Mark-Mind.git'
    "io.github.markmindltd.mark_mind.desktop"
    "io.github.markmindltd.mark_mind.metainfo.xml")
sha256sums=(
    'SKIP'
    'bc8c6db34688ad87879871a9ea28c088a1f44fcdfb7f4e4aef52a425283dde9f'
    'c0050afe68a3c62cc8f15508b1209a41eae4cbd7e358a0bf0ae20bc37178f35f')

pkgver() {
  cd "${srcdir}/${pkgname}"
  git describe --tags | sed -e 's/^[^0-9]*//' -e 's/-/.0./' -e 's/-/./g'
}

build() {
    cd "${srcdir}/${pkgname}"
    npm install
    npm run dev
    npm run build
}

check() {
    cd "${srcdir}/${pkgname}"
    npm test
}

package() {
    install -d "${pkgdir}/opt/${pkgname}"
    cp -r "${srcdir}/${pkgname}/build/linux-unpacked" "${pkgdir}/opt/${pkgname}"

    install -d "${pkgdir}/usr/share/icons"
    cp -r "${srcdir}/${pkgname}/build/icons/icon.png" "${pkgdir}/usr/share/pixmaps/${_oldpkgname}"

    install -d "${pkgdir}/usr/bin"
    ln -sf "${pkgdir}/opt/${pkgname}/${_oldpkgname}" "${pkgdir}/usr/bin/${pkgname}"

    install -Dm 0644 "${srcdir}/io.github.markmindltd.mark_mind.desktop" "${pkgdir}/usr/share/applications/io.github.markmindltd.mark_mind.desktop"
    install -Dm 0644 "${srcdir}/io.github.markmindltd.mark_mind.metainfo.xml" "${pkgdir}/usr/share/metainfo/io.github.markmindltd.mark_mind.metainfo.xml"
}
