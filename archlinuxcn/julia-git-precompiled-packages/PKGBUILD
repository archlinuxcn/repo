# Maintainer: Yichao Yu <yyc1992@gmail.com>

pkgbase=julia-git-precompiled-packages
_jlpackages=(
###=== JLPKG_JLNAME_LIST {{
  ADTypes
  AMD
  ASL_jll
  AWS
  AWSS3
  AbstractAlgebra
  AbstractDifferentiation
  AbstractFFTs
  AbstractLattices
  AbstractTrees
  Accessors
  Adapt
  AdaptivePredicates
  AliasTables
  AlmostBlockDiagonals
  Alpine
  AmplNLWriter
  AndorSIF
  Animations
  Antic_jll
  Aqua
  Arb_jll
  ArgCheck
  ArnoldiMethod
  Arpack
  Arpack_jll
  ArrayInterface
  ArrayLayouts
  Arrow
  ArrowTypes
  Atomix
  Attr_jll
  Automa
  AxisAlgorithms
  AxisArrays
  BFloat16s
  BandedMatrices
  BangBang
  BaseDirs
  BaseType
  Baselet
  BatchedRoutines
  BenchmarkTools
  Bessels
  Bijections
  BitBasis
  BitFlags
  BitIntegers
  BitTwiddlingConvenienceFunctions
  BlockArrays
  BlockBandedMatrices
  BlockDiagonals
  Bloqade
  BloqadeExpr
  BloqadeKrylov
  BloqadeLattices
  BloqadeMIS
  BloqadeODE
  BloqadeSchema
  BloqadeWaveforms
  Blosc
  Blosc_jll
  BlossomV
  Bonito
  BoundaryValueDiffEq
  BoundaryValueDiffEqAscher
  BoundaryValueDiffEqCore
  BoundaryValueDiffEqFIRK
  BoundaryValueDiffEqMIRK
  BoundaryValueDiffEqMIRKN
  BoundaryValueDiffEqShooting
  BracketingNonlinearSolve
  Braket
  BranchAndPrune
  BufferedStreams
  Bzip2_jll
  CDDLib
  CEnum
  CGcoefficient
  CPUSummary
  CRlibm
  CRlibm_jll
  CSTParser
  CSV
  CacheServers
  Cairo
  CairoMakie
  Cairo_jll
  Calculus
  Cassette
  CatIndices
  CategoricalArrays
  Cbc
  Cbc_jll
  Cgl_jll
  ChainRules
  ChainRulesCore
  ChainRulesTestUtils
  ChangesOfVariables
  CircularArrays
  Clang
  Clang_jll
  CliqueTrees
  CloseOpenIntervals
  Clp
  Clp_jll
  Clustering
  CodeTracking
  CodecBase
  CodecBzip2
  CodecLz4
  CodecXz
  CodecZlib
  CodecZstd
  CoinUtils_jll
  Collects
  ColorBrewer
  ColorSchemes
  ColorTypes
  ColorVectorSpace
  Colors
  Combinatorics
  CommonEq
  CommonMark
  CommonSolve
  CommonSubexpressions
  CommonWorldInvalidations
  Compat
  Compiler
  CompositeTypes
  CompositionsBase
  ComputationalResources
  ComputePipeline
  ConcreteStructs
  ConcurrentSim
  ConcurrentUtilities
  Conda
  CondaPkg
  Configurations
  ConjugateGradients
  ConsoleProgressMonitor
  ConstructionBase
  Contour
  CoordinateTransformations
  CovarianceEstimation
  CpuId
  Crayons
  Cubature
  Cubature_jll
  CustomUnitRanges
  CxxWrap
  DSP
  DataAPI
  DataFrames
  DataStructures
  DataValueInterfaces
  Dbus_jll
  DecFP
  DecFP_jll
  DeepDiffs
  DefineSingletons
  DelaunayTriangulation
  DelayDiffEq
  Deno_jll
  DensityInterface
  Dictionaries
  Dierckx
  Dierckx_jll
  DiffEqBase
  DiffEqCallbacks
  DiffEqNoiseProcess
  DiffResults
  DiffRules
  DifferentialEquations
  DifferentiationInterface
  DimensionalData
  DispatchDoctor
  Distances
  Distributions
  DocStringExtensions
  DomainSets
  DynamicPolynomials
  DynamicQuantities
  EarCut_jll
  Einsum
  EliminateGraphs
  EllipsisNotation
  EnumX
  Enzyme
  EnzymeCore
  Enzyme_jll
  EpollShim_jll
  ErrorfreeArithmetic
  ExactPredicates
  ExceptionUnwrapping
  Expat_jll
  ExponentialAction
  ExponentialUtilities
  ExprTools
  Expronicon
  ExproniconLite
  Extents
  EzXML
  FFMPEG
  FFMPEG_jll
  FFTViews
  FFTW
  FFTW_jll
  FLINT_jll
  FameSVD
  FastAlmostBandedMatrices
  FastBroadcast
  FastClosures
  FastExpm
  FastGaussQuadrature
  FastLapackInterface
  FastLevenbergMarquardt
  FastPower
  FastRounding
  FileIO
  FilePaths
  FilePathsBase
  FillArrays
  FindFirstFunctions
  FiniteDiff
  FiniteDifferences
  FixedPointNumbers
  FixedSizeArrays
  FlameGraphs
  FoldingTrees
  Fontconfig_jll
  Format
  ForwardDiff
  FreeType
  FreeType2_jll
  FreeTypeAbstraction
  FreqTables
  FriBidi_jll
  FunctionProperties
  FunctionWrappers
  FunctionWrappersWrappers
  Functors
  GLFW_jll
  GLPK
  GLPK_jll
  GPUArrays
  GPUArraysCore
  GPUCompiler
  GPUToolbox
  GR
  GR_jll
  GSL
  GSL_jll
  GarishPrint
  GaussQuadrature
  GeneralizedGenerated
  GenericLinearAlgebra
  GenericSchur
  GeoFormatTypes
  GeoInterface
  GeometryBasics
  GettextRuntime_jll
  Gettext_jll
  Ghostscript_jll
  Giflib_jll
  GitHub
  GitHubActions
  Glib_jll
  Glob
  Graphics
  Graphite2_jll
  Graphs
  GraphsMatching
  GridLayoutBase
  Grisu
  Groebner
  GroupsCore
  H5Zbitshuffle
  H5Zblosc
  H5Zbzip2
  H5Zlz4
  H5Zzstd
  HCubature
  HDF5
  HDF5_jll
  HTTP
  HYPRE
  HYPRE_jll
  HalfIntegers
  HarfBuzz_jll
  HashArrayMappedTries
  HiGHS
  HiGHS_jll
  Highlights
  HistogramThresholding
  HostCPUFeatures
  Hungarian
  Hwloc_jll
  HybridArrays
  HypergeometricFunctions
  Hyperscript
  HypothesisTests
  IJulia
  ILog2
  IRTools
  IfElse
  ImageAxes
  ImageBase
  ImageBinarization
  ImageContrastAdjustment
  ImageCore
  ImageCorners
  ImageDistances
  ImageFiltering
  ImageIO
  ImageInTerminal
  ImageMagick
  ImageMagick_jll
  ImageMetadata
  ImageMorphology
  ImageQualityIndexes
  ImageSegmentation
  ImageShow
  ImageTransformations
  Images
  Imath_jll
  ImplicitDiscreteSolve
  Indexing
  IndirectArrays
  Inflate
  IniFile
  InitialValues
  InlineStrings
  IntegerMathUtils
  IntegralArrays
  IntelOpenMP_jll
  Interfaces
  Interpolations
  IntervalArithmetic
  IntervalRootFinding
  IntervalSets
  Intervals
  InverseFunctions
  InvertedIndices
  Ipopt
  Ipopt_jll
  IrrationalConstants
  Isoband
  IterTools
  IterativeSolvers
  IteratorInterfaceExtensions
  JLD
  JLD2
  JLFzf
  JSON
  JSON3
  Jieko
  JpegTurbo
  JpegTurbo_jll
  JuMP
  JuliaFormatter
  JuliaInterpreter
  JuliaSyntax
  JuliaVariables
  JumpProcesses
  Juniper
  KLU
  KernelAbstractions
  KernelDensity
  Kronecker
  Krylov
  KrylovKit
  LAME_jll
  LAPACK_jll
  LBFGSB
  LDLFactorizations
  LEMONGraphs
  LEMON_jll
  LERC_jll
  LLVM
  LLVMExtra_jll
  LLVMOpenMP_jll
  LRUCache
  LZO_jll
  L_BFGS_B_jll
  LaTeXStrings
  LabelledArrays
  LambertW
  Latexify
  LatticeRules
  LayoutPointers
  Lazy
  LazyArrays
  LazyModules
  LeastSquaresOptim
  LeftChildRightSiblingTrees
  LegibleLambdas
  LevyArea
  LibArchive_jll
  LibTracyClient_jll
  Libffi_jll
  Libgcrypt_jll
  Libglvnd_jll
  Libgpg_error_jll
  Libiconv_jll
  Libmount_jll
  Librsvg_jll
  Libtiff_jll
  Libuuid_jll
  LightXML
  LineSearch
  LineSearches
  LinearAlgebraX
  LinearMaps
  LinearOperators
  LinearSolve
  LittleCMS_jll
  LogExpFunctions
  LoggingExtras
  LoopVectorization
  Loraine
  LoweredCodeUtils
  LsqFit
  Luxor
  LuxorGraphPlot
  LuxurySparse
  Lz4_jll
  MAT
  MD5
  METIS_jll
  MKL
  MKL_jll
  MLStyle
  MPC_jll
  MPI
  MPICH_jll
  MPIPreferences
  MPItrampoline_jll
  MUMPS_seq_jll
  MacroTools
  MadNLP
  Makie
  MakieCore
  ManifoldDiff
  Manifolds
  ManifoldsBase
  ManualMemory
  MappedArrays
  MarchingCubes
  MathOptIIS
  MathOptInterface
  MathTeXEngine
  MatrixEquations
  MatrixFactorizations
  MaybeInplace
  MbedTLS
  MbedTLS_jll
  Measurements
  Measures
  MetaGraphs
  MicroCollections
  MicroMamba
  MicrosoftMPI_jll
  Missings
  Mocking
  ModelingToolkit
  Mods
  MonteCarloMeasurements
  MosaicViews
  Moshi
  MsgPack
  MuladdMacro
  MultiFloats
  Multisets
  MultivariatePolynomials
  Mustache
  MutableArithmetics
  MyterialColors
  NLPModels
  NLSolversBase
  NLopt
  NLopt_jll
  NLsolve
  NNlib
  NPZ
  NaNMath
  NameResolution
  NamedArrays
  NamedDims
  NamedTupleTools
  NearestNeighbors
  Nemo
  Netpbm
  NetworkLayout
  NodeJS
  NonlinearSolve
  NonlinearSolveBase
  NonlinearSolveFirstOrder
  NonlinearSolveQuasiNewton
  NonlinearSolveSpectralMethods
  ODE
  ODEInterface
  ODEInterface_jll
  OMEinsum
  OMEinsumContractionOrders
  ObjectFile
  Observables
  OffsetArrays
  Ogg_jll
  OpenBLAS32_jll
  OpenBLASConsistentFPCSR_jll
  OpenCL
  OpenCL_jll
  OpenEXR
  OpenEXR_jll
  OpenJpeg_jll
  OpenMPI_jll
  OpenSSL
  OpenSpecFun_jll
  Optim
  Optimisers
  Optimization
  OptimizationBase
  Opus_jll
  OrderedCollections
  OrdinaryDiffEq
  OrdinaryDiffEqAdamsBashforthMoulton
  OrdinaryDiffEqBDF
  OrdinaryDiffEqCore
  OrdinaryDiffEqDefault
  OrdinaryDiffEqDifferentiation
  OrdinaryDiffEqExplicitRK
  OrdinaryDiffEqExponentialRK
  OrdinaryDiffEqExtrapolation
  OrdinaryDiffEqFIRK
  OrdinaryDiffEqFeagin
  OrdinaryDiffEqFunctionMap
  OrdinaryDiffEqHighOrderRK
  OrdinaryDiffEqIMEXMultistep
  OrdinaryDiffEqLinear
  OrdinaryDiffEqLowOrderRK
  OrdinaryDiffEqLowStorageRK
  OrdinaryDiffEqNonlinearSolve
  OrdinaryDiffEqNordsieck
  OrdinaryDiffEqPDIRK
  OrdinaryDiffEqPRK
  OrdinaryDiffEqQPRK
  OrdinaryDiffEqRKN
  OrdinaryDiffEqRosenbrock
  OrdinaryDiffEqSDIRK
  OrdinaryDiffEqSSPRK
  OrdinaryDiffEqStabilizedIRK
  OrdinaryDiffEqStabilizedRK
  OrdinaryDiffEqSymplecticRK
  OrdinaryDiffEqTsit5
  OrdinaryDiffEqVerner
  Osi_jll
  PCRE_jll
  PDMats
  PMIx_jll
  PNGFiles
  PackageExtensionCompat
  Packing
  PaddedViews
  Pajarito
  Pango_jll
  ParallelMergeCSR
  Parameters
  Pardiso
  Parsers
  PartialFunctions
  PartitionedArrays
  Pavito
  Permutations
  Pidfile
  PikaParser
  Pipe
  Pixman_jll
  PkgVersion
  PlotThemes
  PlotUtils
  Plots
  PoissonRandom
  Polyester
  PolyesterWeave
  PolygonAlgorithms
  PolygonOps
  Polyhedra
  Polynomials
  PooledArrays
  PositiveFactorizations
  PreallocationTools
  PrecompileTools
  Preferences
  PrettyPrint
  PrettyTables
  Primes
  ProgressLogging
  ProgressMeter
  PtrArrays
  PyCall
  PyPlot
  PythonCall
  QECCore
  QOI
  QPSReader
  Qt6Base_jll
  Qt6Declarative_jll
  Qt6ShaderTools_jll
  Qt6Wayland_jll
  QuadGK
  QuantumClifford
  QuantumCumulants
  QuantumInterface
  QuantumOptics
  QuantumOpticsBase
  QuantumSavory
  QuantumSymbolics
  QuasiMonteCarlo
  Quaternions
  Random123
  RandomExtensions
  RandomMatrices
  RandomNumbers
  RangeArrays
  RationalRoots
  Ratios
  RealDot
  RecipesBase
  RecipesPipeline
  RecursiveArrayTools
  RecursiveFactorization
  Reexport
  Referenceables
  RegionTrees
  RelocatableFolders
  Requires
  ResettableStacks
  ResumableFunctions
  Retry
  ReverseDiff
  Revise
  Richardson
  RingLists
  Rmath
  Rmath_jll
  Roots
  Rotations
  RoundingEmulator
  Rsvg
  RuntimeGeneratedFunctions
  SCCNonlinearSolve
  SIMD
  SIMDDualNumbers
  SIMDTypes
  SLEEFPirates
  SPIRVIntrinsics
  SPIRV_LLVM_Backend_jll
  SPIRV_LLVM_Translator_unified_jll
  SPIRV_Tools_jll
  SPRAL_jll
  SciMLBase
  SciMLJacobianOperators
  SciMLNLSolve
  SciMLOperators
  SciMLPublic
  SciMLStructures
  ScopedValues
  Scratch
  SecondQuantizedAlgebra
  SentinelArrays
  SetRounding
  Setfield
  ShaderAbstractions
  ShiftedArrays
  Showoff
  SignedDistanceFields
  SimpleBufferStream
  SimpleGraphs
  SimpleNonlinearSolve
  SimplePartitions
  SimplePolynomials
  SimpleRandom
  SimpleTraits
  SimpleUnPack
  SimpleWeightedGraphs
  Sixel
  Sobol
  SodiumSeal
  SoftGlobalScope
  SolverCore
  SortingAlgorithms
  SparseConnectivityTracer
  SparseDiffTools
  SparseInverseSubset
  SparseMatricesCSR
  SparseMatrixColorings
  Sparspak
  SpecialFunctions
  SplitApplyCombine
  SplittablesBase
  StableHashTraits
  StableRNGs
  StackViews
  Static
  StaticArrayInterface
  StaticArrays
  StaticArraysCore
  StatsAPI
  StatsBase
  StatsFuns
  StatsModels
  SteadyStateDiffEq
  StochasticDiffEq
  StrideArraysCore
  Strided
  StridedViews
  StringDistances
  StringEncodings
  StringManipulation
  StringViews
  StructArrays
  StructIO
  StructTypes
  SumTypes
  Sundials
  Sundials_jll
  Suppressor
  SymDict
  SymEngine
  SymEngine_jll
  SymPyCore
  SymPyPythonCall
  SymbolicAnalysis
  SymbolicIndexingInterface
  SymbolicLimits
  SymbolicUtils
  Symbolics
  TSVD
  TZJData
  TableTraits
  Tables
  TaskLocalValues
  TensorCore
  Term
  TermInterface
  TerminalLoggers
  TestItems
  ThreadPools
  ThreadingUtilities
  ThreadsX
  TiffImages
  TiledIteration
  TimeZones
  TimerOutputs
  Tokenize
  Tracker
  Tracy
  TranscodingStreams
  Transducers
  TreeViews
  TreeWidthSolver
  TriangularSolve
  Tricks
  TriplotBase
  TruncatedStacktraces
  Tulip
  TupleTools
  TypedTables
  URIs
  UnPack
  UnicodeFun
  UnicodePlots
  Unitful
  UnitfulLatexify
  Unityper
  UnsafeArrays
  UnsafeAtomics
  UnsafeAtomicsLLVM
  UnsafePointers
  Unzip
  VectorInterface
  VectorizationBase
  VersionParsing
  VertexSafeGraphs
  VideoIO
  Vulkan_Loader_jll
  WGLMakie
  Wayland_jll
  Wayland_protocols_jll
  WeakKeyIdDicts
  WeakRefStrings
  WeakValueDicts
  WebP
  WidgetsBase
  WidthLimitedIO
  WignerSymbols
  WoodburyMatrices
  WorkerUtilities
  XML2_jll
  XMLDict
  XSLT_jll
  XTermColors
  XZ_jll
  Xorg_libICE_jll
  Xorg_libSM_jll
  Xorg_libX11_jll
  Xorg_libXau_jll
  Xorg_libXcursor_jll
  Xorg_libXdmcp_jll
  Xorg_libXext_jll
  Xorg_libXfixes_jll
  Xorg_libXi_jll
  Xorg_libXinerama_jll
  Xorg_libXrandr_jll
  Xorg_libXrender_jll
  Xorg_libpthread_stubs_jll
  Xorg_libxcb_jll
  Xorg_libxkbfile_jll
  Xorg_xcb_util_cursor_jll
  Xorg_xcb_util_image_jll
  Xorg_xcb_util_jll
  Xorg_xcb_util_keysyms_jll
  Xorg_xcb_util_renderutil_jll
  Xorg_xcb_util_wm_jll
  Xorg_xkbcomp_jll
  Xorg_xkeyboard_config_jll
  Xorg_xtrans_jll
  YAML
  Yao
  YaoAPI
  YaoArrayRegister
  YaoBlocks
  YaoPlots
  YaoSubspaceArrayReg
  YaoSym
  YaoToEinsum
  ZMQ
  ZeroMQ_jll
  ZipFile
  Zygote
  ZygoteRules
  acl_jll
  bitshuffle_jll
  cddlib_jll
  eudev_jll
  fzf_jll
  gdk_pixbuf_jll
  gperf_jll
  isoband_jll
  libaec_jll
  libaom_jll
  libass_jll
  libcxxwrap_julia_jll
  libdecor_jll
  libevdev_jll
  libevent_jll
  libfdk_aac_jll
  libinput_jll
  libpng_jll
  libsixel_jll
  libsodium_jll
  libvorbis_jll
  libwebp_jll
  libzip_jll
  micromamba_jll
  mtdev_jll
  oneTBB_jll
  pixi_jll
  x264_jll
  x265_jll
  xkbcommon_jll
###=== }} JLPKG_JLNAME_LIST
)
pkgname=()
pkgver=20250825.165856
pkgrel=1
pkgdesc="Precompiled packages for julia-git"
# This is against the official recommendation but
# having a shorter arch array significantly reduces the lint_pkgbuild time.
case $CARCH in
  i686|x86_64|armv7h|aarch64)
    arch=($CARCH)
    ;;
  *)
    arch=()
    ;;
esac
url="http://julialang.org"
license=('GPL')
depends=(julia-git)
makedepends=(git julia-git-package-env julia-pkg-scripts makepkg-lint-disable-hook
             blas-openblas blas64-openblas)
options=('debug' '!strip')
source=(julia-copy-compiled-pkgs.jl)
sha512sums=('defb7b000385848c2d617422720c452eac87e34959bb18983696dcde8303e101f856fa0b39618ddd7cffbafe24fce183b9f8612a66a7d07e145d3064f09a853f')

pkgver() {
  date -u +%Y%m%d.%H%M%S
}

build() {
  rm -rf arch-compiled
  mkdir -p arch-compiled

  _ver_short=$(julia --startup-file=no \
                     -e 'print(VERSION.major, ".", VERSION.minor)')

  echo "_ver_short=${_ver_short}" > build_vars

  compile_dir="/usr/share/julia/compiled/v$_ver_short"
  stdlib_dir="/usr/share/julia/stdlib/v$_ver_short"
  tgt_dir="${srcdir}/arch-compiled"
  julia julia-copy-compiled-pkgs.jl \
        "$stdlib_dir" "$compile_dir" "$tgt_dir" "${_jlpackages[@]}"
}

_package-jlpackage() {
  # Don't depend on the exact julia version to make it easier to install
  # a new julia version that without updating all the precompiled packages
  # In such a case the precompiled binaries won't be used but the packages
  # should still work.
  # depends+=("julia-git=$(pacman -Q julia-git | sed -e 's/^.* \([^ ]*\)$/\1/')")

  . ./build_vars

  stdlib_dir="/usr/share/julia/stdlib/v$_ver_short"

  jlpkg=$1
  srcpkg="julia-git-${jlpkg,,}-src"

  depends+=("$srcpkg")
  conflicts+=("julia-git-${jlpkg,,}-git") # Temporary
  replaces+=("julia-git-${jlpkg,,}-git") # Temporary

  arch_compile_dir="${pkgdir}/usr/lib/julia/arch-compiled/"
  mkdir -p "$arch_compile_dir"

  . "${srcdir}/arch-compiled/package-${jlpkg}_vars.sh"

  echo "Dependencies: ${depends[*]}"
  echo "Optional dependencies: ${optdepends[*]}"

  cp -r "${srcdir}/arch-compiled/$jlpkg" "${arch_compile_dir}/$jlpkg"
}

if grep -q lint_pkgbuild /usr/bin/makepkg &> /dev/null; then
  # HACK!
  # chroot build would source the PKGBUILD outside the chroot at least once.
  # if we are running without linting disabled, lie to the makepkg about
  # what we are building to skip the lengthy linting.
  pkgname=(julia-git-precompiled-packages)
  package_julia-git-precompiled-packages() {
    true
  }
else
  for jlpkg in "${_jlpackages[@]}"; do
    _pkg="julia-git-${jlpkg,,}"
    pkgname=("${pkgname[@]}" "${_pkg}")
    makedepends+=("${_pkg}-src")
    eval "package_${_pkg}() { _package-jlpackage ${jlpkg}; }"
  done
fi
