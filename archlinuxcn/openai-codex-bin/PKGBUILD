# Maintainer: Jack Mahoney <jacksmahoney@gmail.com>
# Maintainer: DeepChirp <DeepChirp@outlook.com>
pkgname=openai-codex-bin
pkgver=0.54.0
pkgrel=1
pkgdesc="Lightweight coding agent that runs in your terminal (binary release)"
arch=('x86_64' 'aarch64')
url="https://github.com/openai/codex"
license=('Apache-2.0')
provides=("${pkgname%-bin}")
conflicts=("${pkgname%-bin}" "${pkgname%-bin}-git")
optdepends=(
   'git: for working with git repositories'
   'ripgrep: accelerated large-repo search'
)

source_x86_64=(
    "codex-${pkgver}-x86_64.tar.gz::${url}/releases/download/rust-v${pkgver}/codex-x86_64-unknown-linux-gnu.tar.gz"
)
source_aarch64=(
    "codex-${pkgver}-aarch64.tar.gz::${url}/releases/download/rust-v${pkgver}/codex-aarch64-unknown-linux-gnu.tar.gz"
)
sha256sums_x86_64=('37197c148f4b1436363a521458030af7f134f762b0a29e04e97d22342c43f0ee')
sha256sums_aarch64=('7c1d24237d7abd1a2d5a3ed6e8f4603fe63c2f9980c891347803bae01cd38651')

package() {
    cd "$srcdir"

    if [[ "$CARCH" == "x86_64" ]]; then
        install -Dm755 "codex-x86_64-unknown-linux-gnu" "$pkgdir/usr/bin/codex"
    fi

    if [[ "$CARCH" == "aarch64" ]]; then
        install -Dm755 "codex-aarch64-unknown-linux-gnu" "$pkgdir/usr/bin/codex"
    fi
}
