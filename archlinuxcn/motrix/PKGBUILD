#Maintainer: weearc <q19981121@163.com>
#Maintainer: laomocode <3344907598@qq.com>
pkgname=motrix
_pkgname=Motrix
pkgver=v1.4.1
_pkgver=1.4.1
pkgrel=2
epoch=
pkgdesc="elegent downloading tool frontend for aria2c,using vue(release version)"
arch=("x86_64")
url="https://github.com/agalwood/Motrix"
license=('MIT')
groups=()
depends=('bash'
	 'tar'
	 'fakeroot'
	 'glibc'
	 'glib2'
	 'nss'
	 'nspr'
	 'gtk3'
	 'pango'
	 'atk'
	 'nettle'
	 'libxcb'
	)
makedepends=('curl'
	     'yarn'
	     'npm')
checkdepends=()
optdepends=()
provides=()
conflicts=('motrix-git')
replaces=()
backup=()
options=()
install=
changelog=
source=("Motrix.desktop"
	"Motrix.tar.gz"::"https://github.com/agalwood/Motrix/archive/v$_pkgver.tar.gz")
noextract=()
sha256sums=('8b53cda5d868a7a0fe2b2efdb4c8ee918fadc74c1083e7a20b5c2dfa9550b806'
	'cd10cd5c704f0d780ff501e2861a316b95c44d11b653045574ae07b9a3ccaa8b')
validpgpkeys=()

prepare() {
	tar -xvf $_pkgname.tar.gz
	rm $_pkgname.tar.gz
	mv $_pkgname-$_pkgver $_pkgname
	yarn config set registry 'https://registry.npm.taobao.org'
    npm config set registry 'https://registry.npm.taobao.org'
    export ELECTRON_MIRROR='https://npm.taobao.org/mirrors/electron/'
    export SASS_BINARY_SITE='https://npm.taobao.org/mirrors/node-sass'
	sed -i '/"dmg"/,/"linux"/{//!d}' $_pkgname/package.json
	sed -i '/"dmg"/d' $_pkgname/package.json
	sed -i '/"deb"/d' $_pkgname/package.json
	sed -i '/"snap"/d' $_pkgname/package.json
	sed -i '/"pacman"/d' $_pkgname/package.json
	sed -i '/"rpm"/d' $_pkgname/package.json
	sed -i 's/"AppImage"/"dir"/g' $_pkgname/package.json

}

build() {
	cd $_pkgname/
	yarn
 	yarn run build
}
package() {
	install -d ${pkgdir}/opt
	install -d ${pkgdir}/usr/bin
	install -d ${pkgdir}/usr/share/icons
	install -d ${pkgdir}/usr/share/applications
	mv ${srcdir}/$_pkgname/release/linux-unpacked/ ${pkgdir}/opt/motrix
	install -Dm644 ${srcdir}/$_pkgname/build/256x256.png ${pkgdir}/usr/share/icons/$pkgname.png
	install -Dm 644 ${srcdir}/Motrix.desktop ${pkgdir}/usr/share/applications
	rm -rf ${srcdir}
}
