pkgbase=obs-vkcapture
pkgname=("$pkgbase")
pkgver=1.5.5
pkgrel=1
pkgdesc='OBS Linux Vulkan/OpenGL game capture'
arch=('x86_64')
url="https://github.com/nowrep/$pkgbase"
license=('GPL-2.0-or-later')
depends=('vulkan-icd-loader' 'libgl' 'libegl' 'obs-studio')
makedepends=('gcc' 'cmake' 'vulkan-headers' 'obs-studio' bubblewrap)
source=("https://github.com/nowrep/$pkgbase/archive/v$pkgver/$pkgbase-$pkgver.tar.gz")
sha512sums=('6cdc876db1e3cbb147bcc835b9ee076fc4c81b8495a59b7abdbedaacf6d70a9661de71d077be0773be72ba0c8b1a5d0a05708e7282fbafa9fd4d3cab94a38d5e')

build() {
	ls /usr/include/obs -la
	export CMAKE_INCLUDE_PATH=/usr/include/obs:/usr/include
	install -d "${srcdir}/links"
	cp -r \
		/usr/lib/cmake/libobs \
		"${srcdir}/cmake-org"
	install \
		/usr/lib/cmake/libobs/libobsConfig.cmake \
		"${srcdir}/cmake-org/LibObsConfig.cmake"
	bwrap \
		--dev-bind / / \
		--ro-bind \
		"${srcdir}/cmake-org" \
		"/usr/lib/cmake/libobs" \
		-- \
	cmake -B build -S "$pkgbase-$pkgver" \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_INSTALL_DATADIR=/share \
		-DCMAKE_BUILD_TYPE=Release
	bwrap \
		--dev-bind / / \
		--ro-bind \
		"${srcdir}/cmake-org" \
		"/usr/lib/cmake/libobs" \
		-- \
	cmake --build build
}

package_obs-vkcapture() {
	export LibObs_DIR="${srcdir}"
	DESTDIR="$pkgdir" cmake --install build
}
