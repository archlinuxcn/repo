pkgname=overskride
pkgver=0.6.5
pkgrel=1
pkgdesc='A simple yet powerful bluetooth client'
url="https://github.com/kaii-lb/overskride"
license=('GPL-3.0-or-later')
arch=('x86_64' 'aarch64')
depends=('bluez' 'libadwaita' 'libpulse' hicolor-icon-theme glibc gcc-libs dbus dconf glib2 gtk4)
makedepends=('blueprint-compiler' 'cargo' 'git' 'meson')
checkdepends=('appstream-glib')
source=("source::git+$url.git#tag=v${pkgver}")
sha256sums=('ba5eac152c4c4effea3e83c3179ac35555520680b34f4ac859f17fdc10333949')

prepare() {
	cd source
	export CARGO_HOME="$srcdir/CARGO_HOME"
	export RUSTUP_TOOLCHAIN=stable
	cargo fetch --target "$CARCH-unknown-linux-gnu"
}

build() {
	export CARGO_HOME="$srcdir/CARGO_HOME"
	export RUSTUP_TOOLCHAIN=stable
	arch-meson source build
	meson compile -C build
}

check() {
	meson test -C build --print-errorlogs || :
}

package() {
	meson install -C build --no-rebuild --destdir "$pkgdir"
}
