# Maintainer: Gavin Luo <lunt.luo@gmail.com>

pkgname="gnome-shell-extension-copyous"
_uuid=copyous@boerdereinar.dev
pkgver=1.3.0
pkgrel=1
pkgdesc="Modern Clipboard Manager for GNOME"
arch=('any')
url="https://github.com/boerdereinar/copyous"
license=('GPL-3.0+')
depends=('gnome-shell>=48'
         'libgda6'
         'gsound')
makedepends=('pnpm' 'git')
source=("${pkgver}::git+${url}.git#tag=v${pkgver}")
b2sums=('9a218e5d95a37cfc30341de65ca1f744d1ca2cac82f7a207336b62b4085606596a0b6530df70e2efcdad73a321c15ddb606e920ef1070651ecf9aecf28c1b620')

prepare() {
  cd "${srcdir}/${pkgver}"

  git submodule update --init --recursive --depth=1
}

build() {
  cd "${srcdir}/${pkgver}"

  pnpm install --ignore-scripts
  env RELEASE=1 make build
}

package() {
  cd "${srcdir}/${pkgver}"

  local extdir="${pkgdir}"/usr/share/gnome-shell/extensions/"${_uuid}"

  install -dm755 "${extdir}"

  bsdtar xf "dist/"*.zip -C "${extdir}"

  install -Dm644 "${extdir}"/schemas/*.gschema.xml -t "${pkgdir}"/usr/share/glib-2.0/schemas/
  rm -rf "${extdir}"/schemas

  mv "${extdir}/locale" "${pkgdir}"/usr/share/
}
