# Maintainer: Gavin Luo <lunt.luo@gmail.com>

pkgname="gnome-shell-extension-copyous"
_uuid=copyous@boerdereinar.dev
pkgver=1.1.3
pkgrel=1
pkgdesc="Modern Clipboard Manager for GNOME"
arch=('any')
url="https://github.com/boerdereinar/copyous"
license=('GPL-3.0+')
depends=('gnome-shell>=45'
         'libgda6'
         'gsound')
makedepends=('pnpm' 'git')
source=("${pkgver}::git+${url}.git#tag=v${pkgver}")
b2sums=('2475cda1cf03865c8071380048b93d8a05b90d8cdcf9840429deafdc4675cdc3b4bf9b7e47644f44d12ebde5e62b0b54db6fcd63d64ac72031cc8a01a012987f')

prepare() {
  cd "${srcdir}/${pkgver}"

  git submodule update --init --recursive --depth=1
}

build() {
  cd "${srcdir}/${pkgver}"

  pnpm install --ignore-scripts
  env RELEASE=1 make build
}

package() {
  cd "${srcdir}/${pkgver}"

  local extdir="${pkgdir}"/usr/share/gnome-shell/extensions/"${_uuid}"

  install -dm755 "${extdir}"

  bsdtar xf "dist/"*.zip -C "${extdir}"

  install -Dm644 "${extdir}"/schemas/*.gschema.xml -t "${pkgdir}"/usr/share/glib-2.0/schemas/
  rm -rf "${extdir}"/schemas

  mv "${extdir}/locale" "${pkgdir}"/usr/share/
}
